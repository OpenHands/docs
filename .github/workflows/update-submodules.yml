name: Update Submodules

on:
  # Allow manual triggering
  workflow_dispatch:
  
  # Trigger via repository dispatch from source repos
  repository_dispatch:
    types: [docs-updated]
  
  # Schedule to check for updates daily
  schedule:
    - cron: '0 6 * * *'  # Daily at 6 AM UTC

jobs:
  update-submodules:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          submodules: recursive
      
      - name: Update submodules
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # Update all submodules to latest commits
          git submodule update --remote --recursive
          
          # Check if there are any changes
          if git diff --quiet --exit-code; then
            echo "No submodule updates available"
            exit 0
          fi
          
          # Commit and push changes
          git add .
          git commit -m "chore: update submodules to latest versions
          
          Co-authored-by: openhands <openhands@all-hands.dev>"
          git push
      
      - name: Create summary
        run: |
          echo "## Submodule Update Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Updated submodules:" >> $GITHUB_STEP_SUMMARY
          git submodule foreach 'echo "- $name: $(git log --oneline -1)"' >> $GITHUB_STEP_SUMMARY