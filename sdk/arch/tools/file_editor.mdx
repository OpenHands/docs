---
title: FileEditorTool
description: Edit files with diff-based operations, undo support, and intelligent line-based modifications.
---

FileEditorTool provides powerful file editing capabilities with diff-based operations, undo/redo support, and intelligent line-based modifications. It's designed for precise code and text file manipulation.

**Source**: [`openhands/tools/file_editor/`](https://github.com/All-Hands-AI/agent-sdk/tree/main/openhands/tools/file_editor)

## Overview

FileEditorTool provides:
- View file contents with line numbers
- Insert, delete, and replace lines
- String-based find-and-replace
- Undo/redo support
- Automatic diff generation
- File history tracking

## Usage

```python
from openhands.tools import FileEditorTool

# Create tool
file_editor = FileEditorTool.create()

# Use with agent
agent = Agent(llm=llm, tools=[file_editor])
```

## Available Commands

**Source**: [`openhands/tools/file_editor/definition.py`](https://github.com/All-Hands-AI/agent-sdk/blob/main/openhands/tools/file_editor/definition.py)

### view
View file contents with line numbers.

```python
FileEditAction(
    command="view",
    path="script.py"
)
```

Optional parameters:
- `view_range=[start, end]`: View specific line range

### create
Create a new file with content.

```python
FileEditAction(
    command="create",
    path="newfile.py",
    file_text="print('Hello, World!')\n"
)
```

### str_replace
Replace a string in the file.

```python
FileEditAction(
    command="str_replace",
    path="script.py",
    old_str="old_function()",
    new_str="new_function()"
)
```

### insert
Insert text after a specific line.

```python
FileEditAction(
    command="insert",
    path="script.py",
    insert_line=10,
    new_str="    # New code here\n"
)
```

### undo_edit
Undo the last edit operation.

```python
FileEditAction(
    command="undo_edit",
    path="script.py"
)
```

## Action Model

```python
class FileEditAction(Action):
    command: Literal["view", "create", "str_replace", "insert", "undo_edit"]
    path: str  # File path
    file_text: str | None = None  # For create
    old_str: str | None = None  # For str_replace
    new_str: str | None = None  # For str_replace/insert
    insert_line: int | None = None  # For insert
    view_range: list[int] | None = None  # For view
```

## Observation Model

```python
class FileEditObservation(Observation):
    content: str  # Result message or file content
    success: bool  # Operation success status
    diff: str | None = None  # Unified diff for changes
```

## Features

### Diff Generation

Automatic diff generation for all modifications:

```python
# After edit
observation = FileEditObservation(
    content="File edited successfully",
    success=True,
    diff="""
--- script.py
+++ script.py
@@ -1,3 +1,3 @@
 def main():
-    print("old")
+    print("new")
"""
)
```

### Edit History

Track file modification history with undo support:

```python
# Edit file
action1 = FileEditAction(command="str_replace", path="file.py", ...)

# Make another edit
action2 = FileEditAction(command="insert", path="file.py", ...)

# Undo last edit
action3 = FileEditAction(command="undo_edit", path="file.py")
```

### Line-Based Operations

All operations work with line numbers for precision:

```python
# View specific lines
FileEditAction(
    command="view",
    path="large_file.py",
    view_range=[100, 150]  # View lines 100-150
)

# Insert at specific line
FileEditAction(
    command="insert",
    path="script.py",
    insert_line=25,
    new_str="    new_code()\n"
)
```

### String Replacement

Find and replace with exact matching:

```python
# Must match exactly including whitespace
FileEditAction(
    command="str_replace",
    path="config.py",
    old_str="DEBUG = False\nLOG_LEVEL = 'INFO'",
    new_str="DEBUG = True\nLOG_LEVEL = 'DEBUG'"
)
```

## Common Use Cases

### Creating Files

```python
# Create Python script
FileEditAction(
    command="create",
    path="hello.py",
    file_text="#!/usr/bin/env python3\nprint('Hello, World!')\n"
)

# Create configuration file
FileEditAction(
    command="create",
    path="config.json",
    file_text='{"setting": "value"}\n'
)
```

### Viewing Files

```python
# View entire file
FileEditAction(command="view", path="README.md")

# View specific section
FileEditAction(
    command="view",
    path="large_file.py",
    view_range=[1, 50]
)

# View end of file
FileEditAction(
    command="view",
    path="log.txt",
    view_range=[-20, -1]  # Last 20 lines
)
```

### Refactoring Code

```python
# Rename function
FileEditAction(
    command="str_replace",
    path="module.py",
    old_str="def old_name(arg):",
    new_str="def new_name(arg):"
)

# Add import
FileEditAction(
    command="insert",
    path="script.py",
    insert_line=0,
    new_str="import numpy as np\n"
)

# Fix bug
FileEditAction(
    command="str_replace",
    path="buggy.py",
    old_str="    if x = 5:",
    new_str="    if x == 5:"
)
```

## Best Practices

1. **View Before Editing**: Always view file content first
2. **Exact String Matching**: Ensure `old_str` matches exactly
3. **Include Context**: Include surrounding lines for uniqueness
4. **Use Line Numbers**: View with line numbers for precise edits
5. **Check Success**: Verify `observation.success` before proceeding
6. **Review Diffs**: Check generated diffs for accuracy
7. **Use Undo Sparingly**: Undo only when necessary

## Error Handling

### Common Errors

```python
# File not found
FileEditObservation(
    content="Error: File 'missing.py' not found",
    success=False
)

# String not found
FileEditObservation(
    content="Error: old_str not found in file",
    success=False
)

# Multiple matches
FileEditObservation(
    content="Error: old_str matched multiple locations",
    success=False
)

# Invalid line number
FileEditObservation(
    content="Error: insert_line out of range",
    success=False
)
```

### Recovery Strategies

```python
# If string not found, view file first
if not observation.success and "not found" in observation.content:
    # View file to understand current content
    view_action = FileEditAction(command="view", path=path)
```

## Implementation Details

**Source**: [`openhands/tools/file_editor/impl.py`](https://github.com/All-Hands-AI/agent-sdk/blob/main/openhands/tools/file_editor/impl.py)

The editor maintains:
- **File Cache**: Efficient file content caching
- **Edit History**: Per-file undo stack
- **Diff Engine**: Unified diff generation
- **Encoding Detection**: Automatic encoding handling

## Configuration

**Source**: [`openhands/tools/file_editor/utils/config.py`](https://github.com/All-Hands-AI/agent-sdk/blob/main/openhands/tools/file_editor/utils/config.py)

```python
# Constants
MAX_FILE_SIZE = 10 * 1024 * 1024  # 10 MB
MAX_HISTORY_SIZE = 100  # Max undo operations
```

## Security Considerations

- File operations are restricted to working directory
- No execution of file content
- Safe for user-generated content
- Automatic encoding detection prevents binary file issues

## See Also

- **[BashTool](/sdk/architecture/tools/bash.mdx)** - For file system operations
- **[PlanningFileEditorTool](/sdk/architecture/tools/planning_file_editor.mdx)** - Multi-file editing
- **[Tool Definition](/sdk/architecture/sdk/tool.mdx)** - Creating custom tools
- **[Examples](https://github.com/All-Hands-AI/agent-sdk/tree/main/examples)** - Usage examples
