---
title: "Add Test Coverage"
sidebarTitle: "Test Coverage"
description: "Tutorial: Improve test coverage with OpenHands"
---

# Tutorial: Add Test Coverage

Learn how to systematically add tests to an existing codebase using OpenHands.

## Prerequisites

- Existing codebase with limited test coverage
- Testing framework installed (pytest, jest, etc.)
- OpenHands CLI or Cloud access

## Overview

We'll follow this process:

<Steps>
  <Step title="Analyze Coverage">
    Identify untested code
  </Step>
  <Step title="Prioritize">
    Rank by criticality
  </Step>
  <Step title="Generate Tests">
    Use OpenHands to write tests
  </Step>
  <Step title="Verify">
    Run and review tests
  </Step>
</Steps>

## Step 1: Check Current Coverage

First, measure existing coverage:

```bash
# Python
pytest --cov=src --cov-report=html

# JavaScript
npm test -- --coverage
```

## Step 2: Identify Critical Untested Code

Ask OpenHands to analyze:

```markdown
Analyze the codebase and identify critical untested functions.

Focus on:
1. Business logic in src/services/
2. Data validation in src/utils/
3. API handlers in src/api/

List functions with:
- Function name and location
- Why it's critical
- Suggested test cases
```

## Step 3: Generate Tests Systematically

### Module by Module

For each module, provide a clear instruction:

```markdown
Add tests for src/services/order_service.py

Current coverage: 45%
Target coverage: 90%

Functions to test:
1. create_order()
2. calculate_total()
3. apply_discount()
4. validate_order()

Testing patterns:
- Follow existing tests in tests/services/test_user_service.py
- Use fixtures from conftest.py
- Mock external dependencies (PaymentGateway, InventoryService)

For each function, test:
- Happy path
- Edge cases
- Error conditions
```

### Example Output

```python
# tests/services/test_order_service.py
import pytest
from unittest.mock import Mock, patch
from src.services.order_service import OrderService


class TestCreateOrder:
    @pytest.fixture
    def order_service(self):
        return OrderService()

    @pytest.fixture
    def valid_order_data(self):
        return {
            "user_id": 1,
            "items": [{"product_id": 1, "quantity": 2}],
            "shipping_address": {"city": "NYC", "zip": "10001"}
        }

    def test_create_order_success(self, order_service, valid_order_data):
        order = order_service.create_order(valid_order_data)
        assert order.status == "pending"
        assert order.user_id == 1
        assert len(order.items) == 1

    def test_create_order_empty_items(self, order_service):
        with pytest.raises(ValueError, match="Order must have items"):
            order_service.create_order({"user_id": 1, "items": []})

    @patch('src.services.order_service.InventoryService')
    def test_create_order_out_of_stock(self, mock_inventory, order_service):
        mock_inventory.check_stock.return_value = False
        with pytest.raises(OutOfStockError):
            order_service.create_order({"user_id": 1, "items": [...]})
```

## Step 4: Iterate and Refine

After initial tests:

```markdown
Review the test results and improve coverage.

Current status:
- 15 tests added
- 3 tests failing
- Coverage at 78% (target: 90%)

Fix the failing tests and add tests for:
- Edge case: order with more than 100 items
- Edge case: discount code expiration
- Integration: full order workflow
```

## Coverage Strategies

### By Layer

```
Week 1: Service layer (business logic)
Week 2: API layer (endpoints)  
Week 3: Utils (helpers, validators)
Week 4: Integration tests
```

### By Criticality

1. Payment processing
2. Authentication
3. Order management
4. User management
5. Reporting

## Best Practices

<CardGroup cols={2}>
  <Card title="Test Behavior" icon="check">
    Test what code does, not how
  </Card>
  <Card title="Meaningful Names" icon="tag">
    Test names should describe scenarios
  </Card>
  <Card title="Independent Tests" icon="cubes">
    Each test should run in isolation
  </Card>
  <Card title="Fast Tests" icon="bolt">
    Unit tests should be quick
  </Card>
</CardGroup>

## Tracking Progress

Monitor coverage improvement:

```bash
# Generate coverage report
pytest --cov=src --cov-report=term-missing

# Track over time
# Day 1: 45%
# Day 3: 65%
# Day 5: 85%
# Day 7: 92%
```

<Card title="Test Coverage Use Case" icon="vial" href="/use-cases/examples/test-coverage">
  More patterns for test generation
</Card>
